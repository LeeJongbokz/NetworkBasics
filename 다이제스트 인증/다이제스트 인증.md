
## 다이제스트 인증 

- 기본 인증은 편리하고 유연하지만 전혀 안전하지 않음  
  사용자 이름과 비밀번호를 평문으로 보내고, 
  메시지를 위조하지 못하게 보호하려는 어떠한 시도도 하지 않음  
  기본 보안을 안전하게 이용하는 유일한 방법은 SSL과 결합해서 사용하는 것임  
  

- 다이제스트 인증은 기본 인증과 호환되는 더 안전한 대체재로서 개발됨  
  다이제스트 인증은 널리 쓰이지는 않지만, 
  그 개념은 보안 트랜잭션을 구현하고자 하는 이들에게 여전히 유용함.  
  
### 다이제스트 인증의 개선점

- 다이제스트 인증은 기본 인증의 가장 심각한 결함을 수정한 또 다른 HTTP 인증 프로토콜임  
  다이제스트 인증의 특징은 다음과 같음 
  
  (1) 비밀번호를 절대로 네트워크를 통해 평문으로 전송하지 않음  
  (2) 인증 체결을 가로채서 재현하려는 악의적인 사람들을 차단함  
  (3) 구현하기에 따라서, 메시지 내용 위조를 막는 것도 가능함
  (4) 그 외 몇몇 잘 알려진 형태의 공격을 막음  
  

- 다이제스트 인증이 가능한 가장 안전한 프로토콜은 아님  
  안전한 HTTP 트랜잭션을 위한 많은 요구사항을 만족하지 못함  
  그러한 요구사항들에는 전송 계층 보안(TLS)과 보안 HTTP(HTTPS)가  
  더 적합한 프로토콜임  
  
- 그러나 기본 인증을 대체하기 위해 설계된 다이제스트 인증은 기본 인증보다 훨씬 강력함  
  다이제스트 인증은 또한 다른 인터넷 서비스를 위해 제안된  
  많은 인기 있는 보안 체계들(LDAP, POP, CRAM-MD5)보다 더 강력함
  

### 비밀번호를 안전하게 지키기 위해 요약 사용하기

- 다이제스트 인증의 좌우명은 "절대로 비밀번호를 네트워크를 통해 보내지 않음"임    
  비밀번호를 보내는 대신, 클라이언트는 비밀번호를 비가역적으로 뒤섞은  
  '지문' 혹은 '요약'을 보냄  
  클라이언트와 서버는 둘 다 비밀번호를 알고 있으므로,  
  서버는 클라이언트가 보낸 요약이 비밀번호에 알맞게 대응하는지 검사할 수 있음  
  요약만 주어진 상황에서, 악당은 세상에 존재하는 모든 비밀번호를  
  하나씩 시도해보지 않고서는, 원래 비밀번호가 어떘는지 알아내기 어려움.  
 
 
### 다이제스트 인증의 동작 원리

(1) 클라이언트가 보호된 문서를 요구함

(2) 서버는 클라이언트가 비밀번호를 알고 있음을 스스로 증명하여,    
    신원을 인증하기 전까지 문서를 제공하는 것을 거부함  
    서버는 클라이언트에게 사용자 이름과 요약된 형태의 비밀번호를 요구함  
    
(3) 클라이언트는 비밀번호의 요약을 전달하여 자신이 비밀번호를 알고 있음을 증명함  
    서버는 모든 사용자의 비밀번호를 알고 있으므로,  
    클라이언트가 제공한 요약과 서버가 스스로 계산한 요약이 일치하는지 비교하여  
    사용자가 비밀번호를 알고 있는지 확인할 수 있음  
    비밀번호를 모르는 사람은 올바른 요약을 만들어 내기 쉽지 않음  
    
(4) 서버는 클라이언트가 제공한 요약과 서버가 내부적으로 계산한 요약을 비교함  
    일치하면 이는 클라이언트가 비밀번호를 알고 있는 것임  
    이 요약 함수는 매우 긴 자릿수의 숫자를 만들어 낼 수 있도록 되어 있기 때문에  
    사실상 찍어서 맞추는 것은 불가능함  
    서버가 일치 여부를 확인하면, 클라이언트에게 문서가 제공됨  
    이 모든 과정에서 비밀번호는 결코 네트워크를 통해 전송되지 않음  
    
![KakaoTalk_20220125_205052557_02](https://user-images.githubusercontent.com/8718430/150972660-f3d680ff-d866-4afb-9176-3b799488c7d2.jpg)

  
### 단방향 요약

- 요약은 '정보 본문의 압축'임. 
  요약은 단방향 함수로 동작하고, 일반적으로 입력 가능한 무한 가지의 모든 입력값들을  
  유한한 범위의 압축으로 변환함.  
  인기 있는 요약 함수 중 하나인 MD5는 임의의 바이트 배열을 원래 길이와 상관없이 128비트 요약으로 변환함  
  128비트, 즉 2의 128승 가지의 서로 다른 압축이 만들어질 수 있음  
  
- 이 요약에서 중요한 것은, 만약 비밀번호를 모른다면 서버에게 보내줄 알맞은 요약을 추측하기 위해  
  매우 많은 시간을 소모하게 될 것이라는 점임.  
  그리고 마찬가지로, 요약을 갖고 있다면 거의 무한개의 입력값들 중 그 요약을 생성하는 것을 찾기 위해  
  끔찍하게 많은 시간을 소모하게 될 것임  
  
- 128비트의 MD5 출력은 종종 32글자의 16진수 문자로 표현되며, 각 문자는 각각 4비트의 값을 의미함  

  ![KakaoTalk_20220125_205052557](https://user-images.githubusercontent.com/8718430/150972499-8532dc3c-1aa9-4f35-9ed2-4ff0583829c6.jpg)

  
 
### 재전송 방지를 위한 난스(nonce) 사용

- 단방향 요약은 비밀번호를 그대로 전송해야 할 필요성에서 우리를 해방시켜줌  
  우리는 그 대신 그냥 비밀번호에 대한 요약을 보내주고,  
  악의적인 집단이 쉽게 요약에서 원래 비밀번호를 해독할 수 없음을 보장받기만 하면 됨  
  
- 불행히도, 불투명 비밀번호 자체로는 우리를 위험에서 지켜주지 못하는데,  
  왜냐면 악당은 비밀번호를 모른다고 해도 요약을 가로채서 서버로 몇 번이고 재전송할 수 있기 때문임  
  요약은 비밀번호 자체와 다름 없음
  
- 이런 재전송 공격을 방지하기 위해서 서버는 클라이언트에게 난스라고 불리는, 특별한, 그리고 자주 바뀌는 증표를 건네줌  
  난스를 비밀번호에 섞으면 난스가 바뀔 때마다 요약도 바뀌게 만들어줌.  
  이것은 재전송 공격을 막아주는데, 왜냐하면 저장된 비밀번호 요약은 특정 난스 값에 대해서만 유효하고, 
  비밀번호 없이 공격자가 올바른 요약을 계산하는 것은 가능하지 않기 때문임  
  
- 다이제스트 인증은 난스를 사용할 것을 요구하는데,  
  왜냐면 자잘한 재전송 공격들이 난스를 쓰지 않는 다이제스트 인증을 실질적으로 기본 인증만큼  
  허약한 것으로 만들기 때문임.
  난스는 WWW-Authenticate 인증요구에 담겨서 서버에서 클라이언트로 넘겨짐
  

### 다이제스트 인증 핸드셰이크

- HTTP 다이제스트 인증 프로토콜은 기본 인증에서 사용하는 것과 비슷한 헤더를 사용하는  
  강화된 버전의 인증임  
  기존 헤더에 몇몇 새 옵션이 추가되었고, 선택적인 헤더인 Authorization-Info가 새로 추가되었음  
  다이제스트 인증의 세 단계 핸드셰이크는 그림 13-2에서 단순화하여 묘사함  
  
  (1) 1단계에서 서버는 난스 값을 계산함  
      2단계에서 서버는 난스를 WWW-Authenticate 인증 요구 메시지에 담아,  
      서버가 지원하는 알고리즘 목록과 함께 클라이언트에 전송함  
  
  (2) 3단계에서 클라이언트는 알고리즘을 선택하고,  
      비밀번호와 그 외 데이터에 대한 요약을 계산함  
      4단계에서 클라이언트는 Authorization 메시지에 요약을 담아 서버에게 돌려줌  
      만약 클라이언트가 서버를 인증하길 원한다면 클라이언트 난스를 보낼 수 있음  
  
  (3) 5단계에서 서버는 요약, 선택한 알고리즘, 그 외 보조 데이터들을 받고,  
      클라이언트가 했던 그대로 요약을 계산함.
      서버는 그 다음 자신이 계산한 요약과 네트워크로 전송되어 온 요약이 서로 같은지 확인함  
      만약 클라이언트가 대칭적으로 서버에게 클라이언트 난스를 갖고 인증을 요구했다면,  
      클라이언트 요약이 만들어짐.  
      또한 서버는 클라이언트가 미리 다음번 요약을 올바르게 생성할 수 있도록  
      다음번 난스를 미리 계산해서 클라이언트에게 넘겨줄 수도 있음  
   
      ![KakaoTalk_20220125_205052557_01](https://user-images.githubusercontent.com/8718430/150972565-bed35697-f063-4093-8564-04f1a09e38e7.jpg)



  
  
  
  
  
  

  
